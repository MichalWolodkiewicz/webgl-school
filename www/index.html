<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WebGL school</title>
    <script type="text/javascript" src="model/dragon.js"></script>
    <script type="text/javascript" src="model/dragon_object.js"></script>
    <script type="text/javascript" src="js/kernels.js"></script>
    <script type="text/javascript" src="js/libs.js"></script>
    <script type="text/javascript" src="js/glUtils.js"></script>
    <script type="text/javascript" src="js/ui_controller.js"></script>
    <style type="text/css">
        .ui-property-box {
            margin-top: 5px;
            margin-bottom: 5px;
            border: 1px dashed black;
        }
    </style>
</head>
<body onload="initWebGL(); initLogger();" style="text-align: center;">
<div>
    <div style="float:left;width:35%" id="ui">
        <div class="ui-property-box">
            <b>Translation:</b><br/>
            X<input type="range" id="translation_x" oninput="onTranslationInputChange('x')" min="-150" max="150"
                    step="1"><br/>
            Y<input type="range" id="translation_y" oninput="onTranslationInputChange('y')" min="-150" max="150"
                    step="1"><br/>
            Z<input type="range" id="translation_z" oninput="onTranslationInputChange('z')" min="-150" max="150"
                    step="1"><br/>
        </div>
        <div id="kernelFilter" class="ui-property-box">
            <b>Kernel filter:</b><br/>
        </div>
        <div class="ui-property-box">
            <b>Scale:</b><br/>
            <input type="range" id="scaleInput" oninput="onScaleInputChange()" min="1" max="200"
                   step="1"><br/>
        </div>
        <div class="ui-property-box">
            <b>Rotation:</b><br/>
            X<input type="range" id="rotation_x" oninput="onRotationInputChange('x')" min="0" max="360"
                    step="1" value="0"><br/>
            Y<input type="range" id="rotation_y" oninput="onRotationInputChange('y')" min="0" max="360"
                    step="1" value="0"><br/>
            Z<input type="range" id="rotation_z" oninput="onRotationInputChange('z')" min="0" max="360"
                    step="1" value="0"><br/>
        </div>
        <div class="ui-property-box">
            <b>Projection:</b><br/>
            angle<input type="range" id="projectionAngle" oninput="onProjectionAngleChange()" min="0" max="360"
                        step="1" value="40"><span id="projectionAngleValueLabel">40</span> <br/>
            near<input type="range" id="perspectiveZMin" oninput="onPerspectiveZMinChange()" min="1" max="100"
                       step="1" value="1"><span id="perspectiveZMinValueLabel">0.1</span> <br/>
            far<input type="range" id="perspectiveZMax" oninput="onPerspectiveZMaxChange()" min="0" max="100"
                      step="1" value="100"><span id="perspectiveZMaxValueLabel">100</span> <br/>
        </div>
        <div class="ui-property-box">
            <b>Camera:</b><br/>
            rotate x<input type="range" id="cameraRotation_x" oninput="onCameraAngleChange('x')" min="0" max="360"
                           step="1" value="0"><span id="cameraRotationLabel_x">0</span> <br/>
            rotate y<input type="range" id="cameraRotation_y" oninput="onCameraAngleChange('y')" min="0" max="360"
                           step="1" value="0"><span id="cameraRotationLabel_y">0</span> <br/>
            rotate z<input type="range" id="cameraRotation_z" oninput="onCameraAngleChange('z')" min="0" max="360"
                           step="1" value="0"><span id="cameraRotationLabel_z">0</span> <br/>

            translate x<input type="range" id="cameraTranslation_x" oninput="onCameraTranslationChange('x')" min="-50"
                              max="50" step="1" value="0"><span id="cameraTranslationLabel_x">0</span> <br/>
            translate y<input type="range" id="cameraTranslation_y" oninput="onCameraTranslationChange('y')" min="-50"
                              max="50" step="1" value="0"><span id="cameraTranslationLabel_y">0</span> <br/>
            translate z<input type="range" id="cameraTranslation_z" oninput="onCameraTranslationChange('z')"
                              min="-50" max="50" step="1" value="2"><span id="cameraTranslationLabel_z">0</span> <br/>
        </div>
        <div class="ui-property-box">
            <b>Lighting:</b><br/>
            source ambient color<br/>
            <input type="number" id="_sourceAmbientColor_0" onchange="onVectorLightingPropertyChange(0,
            '_sourceAmbientColor')"/>
            <input type="number" id="_sourceAmbientColor_1" onchange="onVectorLightingPropertyChange(1,
            '_sourceAmbientColor')"/>
            <input type="number" id="_sourceAmbientColor_2" onchange="onVectorLightingPropertyChange(2,
            '_sourceAmbientColor')"/>
            <br/>
            <!--const vec3 source_diffuse_color=vec3(1.,2.,4.);
            const vec3 source_specular_color=vec3(1.,1.,1.);
            const vec3 source_direction=vec3(0.,0.,1.);
            const vec3 mat_ambient_color=vec3(0.3,0.3,0.3);
            const vec3 mat_diffuse_color=vec3(1.,1.,1.);
            const vec3 mat_specular_color=vec3(1.,1.,1.);
            const float mat_shininess=10.;-->
        </div>
    </div>
    <div style="float:right;width:65%">
        <canvas width="600px" height="600px" id="glCanvas"></canvas>
    </div>
</div>
<script id="shader-vs" type="x-shader/x-fragment">
    attribute vec3 position;
    attribute vec2 a_tex_coords;
    attribute vec3 a_normal;
    varying vec2 tex_coords;
    varying vec3 v_normal;
    varying vec3 v_view;
    uniform mat4 u_matrix;
    void main(void) {
        gl_Position = u_matrix*vec4(position, 1.0);
        v_normal = vec3(u_matrix*vec4(a_normal, 0.0));
        v_view = vec3(u_matrix*vec4(position, 1.));
        tex_coords = a_tex_coords;
    }
</script>
<script id="shader-fs" type="x-shader/x-fragment">
    precision mediump float;
    varying vec2 tex_coords;
    uniform sampler2D u_image;
    void main(void) {
        gl_FragColor = texture2D(u_image, tex_coords);
    }
</script>

<script id="shader-solid-color-fs" type="x-shader/x-fragment">
    precision mediump float;
    varying vec2 tex_coords;
    uniform sampler2D u_image;
    void main(void) {
        gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);
    }
</script>

<script id="shader-convultion-fs" type="x-shader/x-fragment">
     precision mediump float;
     varying vec2 tex_coords;
     varying vec3 v_normal;
     uniform sampler2D u_image;
     //convultion effect variables
     uniform vec2 u_textureSize;
     uniform float u_kernel[9];
     uniform float u_kernelWeight;
     void main(void) {
         vec2 onePixel = vec2(1.0, 1.0) / u_textureSize;
         vec4 colorSum =
            texture2D(u_image, tex_coords + onePixel * vec2(-1, -1)) * u_kernel[0] +
            texture2D(u_image, tex_coords + onePixel * vec2( 0, -1)) * u_kernel[1] +
            texture2D(u_image, tex_coords + onePixel * vec2( 1, -1)) * u_kernel[2] +
            texture2D(u_image, tex_coords + onePixel * vec2(-1,  0)) * u_kernel[3] +
            texture2D(u_image, tex_coords + onePixel * vec2( 0,  0)) * u_kernel[4] +
            texture2D(u_image, tex_coords + onePixel * vec2( 1,  0)) * u_kernel[5] +
            texture2D(u_image, tex_coords + onePixel * vec2(-1,  1)) * u_kernel[6] +
            texture2D(u_image, tex_coords + onePixel * vec2( 0,  1)) * u_kernel[7] +
            texture2D(u_image, tex_coords + onePixel * vec2( 1,  1)) * u_kernel[8] ;
            gl_FragColor = vec4((colorSum / u_kernelWeight).rgb, 1.0);
    }
</script>

<script id="shader-lighting-fs" type="x-shader/x-fragment">
     precision mediump float;
     varying vec2 tex_coords;
     varying vec3 v_normal;
     varying vec3 v_view;
     uniform sampler2D u_image;
     //lighting
     uniform vec3 u_source_ambient_color;
     const vec3 source_diffuse_color=vec3(1.,2.,4.);
     const vec3 source_specular_color=vec3(1.,1.,1.);
     const vec3 source_direction=vec3(0.,0.,1.);
     const vec3 mat_ambient_color=vec3(0.3,0.3,0.3);
     const vec3 mat_diffuse_color=vec3(1.,1.,1.);
     const vec3 mat_specular_color=vec3(1.,1.,1.);
     const float mat_shininess=10.;
     void main(void) {
        vec3 color = vec3(texture2D(u_image, tex_coords));
        vec3 I_ambient = u_source_ambient_color*mat_ambient_color;
        vec3 I_diffuse = source_diffuse_color*mat_diffuse_color*max(0., dot(v_normal, source_direction));
        vec3 V = normalize(v_view);
        vec3 R = reflect(source_direction, v_normal);
        vec3 I_specular = source_specular_color*mat_specular_color*pow(max(dot(R,V),0.), mat_shininess);
        vec3 I = I_ambient+I_diffuse+I_specular;
        gl_FragColor = vec4(I*color, 1.);
     }
</script>

</body>
</html>